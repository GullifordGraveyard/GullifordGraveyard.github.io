<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" >
<meta name="viewport" content="width=device-width, initial-scale=1" >
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<!-- jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<!-- Latest compiled JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>
<body onLoad="loadTopics()">   <!-- load topics into dropdown list when body loads. -->

<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>                        
      </button>
      <a class="navbar-brand">FAQ</a>
    </div>
    <div class="collapse navbar-collapse" id="myNavbar">
      <ul class="nav navbar-nav">
        <li class="active"><a href="http://community.dur.ac.uk/elliot.moffatt/faq2016/index.html">Index</a></li>
        <li><a href="http://community.dur.ac.uk/elliot.moffatt/faq2016/admin.html">Admin</a></li>
      </ul>
    </div>
  </div>
</nav>
<!-- navbar code adapted from http://www.w3schools.com/bootstrap/bootstrap_navbar.asp  -->

<div class="container">

<h1> Index </h1>
<br>
<br>

<!--  HTML CODE GOES HERE -->

<div id="search_topics" style="display:inline">

	 <form class="form-horizontal" id="form1" onsubmit="getResults();">
	  <div class="form-group">
		  <label class="control-label col-sm-2">Topic:</label>
		  <div class="col-sm-10">
			<select id= "topic" name="topic" class="form-control" onchange="showTextFields()">
					<option selected>Choose a topic</option>
					<!-- other options are filled in from topics.php when body loads -->
				</select>
		  </div>
		</div>
	  <div id="hidden" style="display: none">
		<div class="form-group">
		  <label class="control-label col-sm-2">Query:</label>
		  <div class="col-sm-8">          
			<input type="text" class="form-control" id="q" placeholder="Enter query">
		  </div>
		</div> 
		<div class="form-group">
		<label class="control-label col-sm-2"></label>
		  <div class="col-sm-10">          
				<button id="submitBtn" type="button" class="btn btn-default" onclick="getResults(); showTextFields()">
					<span class="glyphicon glyphicon-search"></span> Search
				</button>
		  </div>
				
		</div>

		</div>
	  </form>
	  
 </div> 
  
<br>
  <div id="alert_placeholder"></div>
<br>

<div id="results" style="display:inline">
	<div class="row" >
		<div class="col-xs-3 col-sm-4 col-md-2 col-lg-1">
			<h2>FAQ Results:</h2>
		</div>
		<div class="col-xs-9 col-sm-8 col-md-10 col-lg-11"></div>
	</div>
	<div class="row">
		<div id="resultsGoHere" class="col-xs-11 col-sm-11 col-md-11 col-lg-11"></div>
		<div class="col-xs-1 col-sm-1 col-md-1 col-lg-1"></div>
	</div>
</div>

<div id="tweets" style="display:inline">
	<div class="row" >
		<div class="col-xs-6 col-sm-6 col-md-4 col-lg-4">
			<h2>Relevent Tweets:</h2>
		</div>
		<div class="col-xs-6 col-sm-6 col-md-8 col-lg-8"></div>
	</div>
	<div class="row">
		<div id="tweetsGoHere" class="col-xs-11 col-sm-11 col-md-11 col-lg-11"></div>
		<div class="col-xs-1 col-sm-1 col-md-1 col-lg-1"></div>
	</div>
</div>


<script type="text/javascript">
$.ajaxSetup ({
    // Disable caching of AJAX responses (not really sure why I need this, but practical instructor advised including it)
    cache: false,
});

//Javascript code goes here

$('form').submit(false);


function loadTopics(){  //loads topics into dropdown list from topics.php
	$.get("http://127.0.0.1:8080",
	function(data) {

		var select = document.getElementById("topic");
		var options = [];
		var option = document.createElement('option');

		for(var i = 0; i < data.length; i++) {
			var obj = data[i];
			option.text = option.value = obj;
			options.push(option.outerHTML);
			};
		select.insertAdjacentHTML('beforeEnd', options.join('\n'));
	});
};
//function adapted from http://stackoverflow.com/questions/18417114/add-item-to-dropdown-list-in-html-using-javascript



function showTextFields(){ //keeps text entry fields hidden until a topic is chosen (and hides it if topic is deselected)
	var index = document.getElementById("topic").selectedIndex;	
	var hidden = document.getElementById("hidden")
	var resultsdiv = document.getElementById("results")
	if(index == 0){
		hidden.style.display = 'none';
		resultsdiv.style.display = 'none';
	}
	else{
		hidden.style.display = 'inline';
		if(!$('#resultsGoHere').is(':empty')){
			resultsdiv.style.display = 'inline';
		};	
	};
};

function getResults(){
	if(document.getElementById("q").value != ""){
		$.get("http://127.0.0.1:8080",		
		{
			topic:document.getElementById("topic").selectedIndex,
			text:document.getElementById("q").value
		},
		function(data,status){		
			//empty current results
			$("#resultsGoHere").empty();
			if (data.faqs.length > 0){
				for(var i = 0; i < data.faqs.length; i++) {
					var obj = data.faqs[i];
						$("#resultsGoHere").append("Question: " + obj.question + "<br>Answer: " + obj.answer + "<br><br>");
				};
			}
			else{
				$("#resultsGoHere").append("No relevent FAQs.")
			};
			
			$("#tweetsGoHere").empty();
			if (data.tweets.positive.length > 0){
				for(var i = 0; i < data.tweets.positive.length; i++) {
					var obj = data.tweets.positive[i];
					$("#tweetsGoHere").append("Tweet: " + obj.text + "<br>ID: " + obj.id + "<br>Sentiment: " + obj.sentiment +"<br><br>");
				};
			};
			if (data.tweets.negative.length > 0){
				for(var i = 0; i < data.tweets.negative.length; i++) {
					var obj = data.tweets.negative[i];
					$("#tweetsGoHere").append("Tweet: " + obj.text + "<br>ID: " + obj.id + "<br>Sentiment: " + obj.sentiment +"<br><br>");
				};
			};
		});	
	}
	else{
		$('#alert_placeholder').html(
				'<div id="alert" class="alert alert-danger alert-dismissable fade in"><a class="close" data-dismiss="alert" aria-label="close">&times;</a><strong>Failure!</strong>' + "  No query entered"  +
				'</div>'
			);
	};
	return false;
};

$(document).ready(function(){
	$('.alert').ready(function(){
		window.setTimeout(function() { $('#alert').alert('close'); }, 4000);
	});

	$('.form-control').focus(function(){
		$('#alert_placeholder').empty();
	});
	
	$('#topic').change(function(){
		$('#resultsGoHere').empty();
		$('#tweetsGoHere').empty();
	});
});



</script>

</div>  <!-- end of container div -->
</body>
</html> 